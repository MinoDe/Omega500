<!DOCTYPE html>
<html>
	<head>
		<title>Ω500 Mixin test</title>
		<meta charset="utf-8">
		<link rel="stylesheet" href="../res/main.css">
	</head>
	<body>
		<section>
			<canvas id="board"></canvas>
			<a class="home" href="./">back</a>
			Use arrow keys to move around
		</section>

		<script src="../../build/Ω500.js"></script>

		<script>

			var Guy = Ω.Entity.extend({

				w: 18,
				h: 25,

				color: "#488",

				tick: function (map) {

					this._super(); // Required to tick mixins

					if (Ω.input.isDown("up")) {
						//this.yo = -2;
						this.addForce && this.addForce(0, -2);
					}
					if (Ω.input.isDown("down")) {
						//this.yo = 2;
						this.addForce && this.addForce(0, 2);
					}
					if (Ω.input.isDown("left")) {
						//this.xo = -2;
						this.addForce && this.addForce(-2, 0);
					}
					if (Ω.input.isDown("right")) {
						//this.xo = 2;
						this.addForce && this.addForce(2, 0);
					}

					this.move(this.xo, this.yo, map);

				},

				render: function (gfx) {

					var c = gfx.ctx;

					c.fillStyle = this.remove ? "#900" : this.color;
					c.fillRect(this.x, this.y, this.w, this.h);

				}

			});


			var MainScreen = Ω.Screen.extend({

				sheet: new Ω.SpriteSheet("../res/sheets/tiles.png", 32, 32),

				init: function () {

					this.map = new Ω.Map(this.sheet, [
						[1,1,1,1,1,1,1,1,1,1,1,1,1],
						[1,0,0,0,0,0,0,0,0,0,0,0,1],
						[1,0,0,1,1,1,0,1,1,1,1,0,1],
						[1,0,0,0,0,0,0,0,0,0,0,0,1],
						[1,0,1,1,1,1,0,1,1,1,1,0,1],
						[1,0,0,0,0,4,0,4,0,0,0,0,1],
						[1,0,0,0,0,0,0,0,0,0,0,0,1],
						[1,0,2,2,2,2,2,2,2,2,2,0,1],
						[1,0,0,0,0,0,0,0,0,0,0,0,1],
						[1,1,1,1,1,1,1,1,1,1,1,1,1]
					]);

					// Make some players & mix in some things
					this.p1 = new Guy(6 * 32, 6 * 32);
					this.p1.mixin([
						{trait: Ω.traits.RemoveAfter, ticks: 300},
						{trait: Ω.traits.Ticker, ticks: 100, cb: function (t) {
							this.color = "#0f0";
						}},
						{trait: Ω.traits.Sin, speed: 70, amp: 10},
						{trait: Ω.traits.Sin, speed: 170, amp: 2, target: "xo"}
					]);

					this.p2 = new Guy(2 * 32, 2 * 32);
					console.log(Ω.traits.Velocity);
					this.p2.mixin([
						{trait: Ω.traits.Sin, speed: 170, amp: 30},
						{trait: Ω.traits.Velocity},
					]);

				},

				tick: function () {

					// Update the player
					this.p1.tick(this.map);
					this.p2.tick(this.map);

				},

				render: function (gfx) {

					var c = gfx.ctx;

					this.clear(gfx, "#000");

					// Draw the player and map
					this.map.render(gfx);
					this.p1.render(gfx);
					this.p2.render(gfx);

				}

			});

			new (Ω.Game.extend({

				canvas: "#board",

				load: function () {

					Ω.input.bind([
						["left", "left"],
						["right", "right"],
						["up", "up"],
						["down", "down"]
					]);

					this.setScreen(new MainScreen());

				}

			}))(400, 300);

		</script>
	</body>
</html>
