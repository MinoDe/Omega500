<!DOCTYPE html>
<html>
	<head>
		<title>Ω500 Screens</title>
		<meta charset="utf-8">
		<link rel="stylesheet" href="../res/main.css">
	</head>
	<body>
		<section>
			<canvas id="board"></canvas>
			<a class="home" href="./">back</a>
		</section>

		<!-- lib files -->
		<script src="../../Ω/Ω.js"></script>
		<script src="../../Ω/utils/base.js"></script>
		<script src="../../Ω/utils/utils.js"></script>
		<script src="../../Ω/utils/Timer.js"></script>
		<script src="../../Ω/gfx.js"></script>
		<script src="../../Ω/input.js"></script>
		<script src="../../Ω/SpriteSheet.js"></script>
		<script src="../../Ω/maps/Map.js"></script>
		<script src="../../Ω/maps/DebugMap.js"></script>
		<script src="../../Ω/screens/Screen.js"></script>
		<script src="../../Ω/Game.js"></script>

		<script src="../../vendor/graph.js"></script>
		<script src="../../vendor/astar.js"></script>
		<script>

			var TitleScreen = Ω.Screen.extend({

				sheet: new Ω.SpriteSheet("../res/images/tiles.png", 32, 32),

				loaded: false,

				init: function () {

					var self = this;

					Ω.gfx.loadImage("../res/images/level.png", function (img){

						self.map = new Ω.DebugMap(13, 13, 1, 1);
						self.map.imgToCells(img);

						var cells = self.map.cells.map(function (r) {
								return r.map(function (c) {
									return c > 0 ? 1 : 0;
								});
							}),
							graph = new Graph(cells),
							start = graph.nodes[1][1],
							end = graph.nodes[16][28];

						self.path = astar.search(graph.nodes, start, end);

						self.loaded = true;

					}, -1);

				},

				tick: function () {

					this.msgX = (Math.sin(Date.now() / 100) * 3) + Ω.env.w * 0.4;
					this.msgY = (Math.cos(Date.now() / 100) * 3) + Ω.env.h * 0.5;

				},

				render: function (gfx) {

					var c = gfx.ctx,
						self = this,
						cw = this.map.sheet.w,
						ch = this.map.sheet.h;

					this.clear(gfx, "#000");
					this.map.render(gfx);

					if (!this.path.length) {
						return;
					}

					c.strokeStyle = "#ff0";
					c.beginPath();
					c.moveTo(1 * (cw / 2), 1 * (ch / 2));
					this.path.forEach(function (r) {
						c.lineTo(r.y * cw + cw / 2, r.x * ch + ch / 2);
					});
					c.stroke();


				}

			});

			/*

				Simplest "game" with Screen

			*/
			new (Ω.Game.extend({

				canvas: "#board",

				init: function (w, h) {

					this._super(w, h);

					Ω.input.bind([
						["space", "space"],
						["left", "left"],
						["right", "right"],
						["up", "up"],
						["down", "down"]
					]);

					this.setScreen(new TitleScreen());

				}

			}))(400, 300);

		</script>
	</body>
</html>
